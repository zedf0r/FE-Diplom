import{Q as o,Z as v,j as e,B as l,aC as N,Y as P,W as S,U as C,q as T}from"./index-TsbhEDbY.js";import{I as B}from"./Tariff-BdsjqfhE.js";import"./CardRoutes-Bgvv39q0.js";const O="_order_1pom4_1",Y="_order__button_1pom4_8",$="_order__info_1pom4_12",k="_info__box_1pom4_19",D="_info__title_1pom4_25",E="_passengers_1pom4_33",I="_passengers__info_1pom4_39",w="_passenger_1pom4_33",M="_passengers__total_1pom4_49",q="_total__text_1pom4_56",A="_total__price_1pom4_64",H="_total__valute_1pom4_70",L="_circle_1pom4_75",Q="_passenger__age_1pom4_91",R="_passenger__info_1pom4_107",U="_passenger__fio_1pom4_113",V="_type__payment_1pom4_125",W="_payment__button_1pom4_137",t={order:O,order__button:Y,order__info:$,info__box:k,info__title:D,passengers:E,passengers__info:I,passenger:w,passengers__total:M,total__text:q,total__price:A,total__valute:H,circle:L,passenger__age:Q,passenger__info:R,passenger__fio:U,type__payment:V,payment__button:W},Z=()=>{const{ticket:s,totalPrice:_}=o(r=>r.tickets),{passengers:i}=o(r=>r.passengers),{selectedPlace:p}=o(r=>r.seats),{payment:m}=o(r=>r.payments),x=v(),u=(r,n)=>r.map((a,b)=>{const c=n[b]??"";return{coach_id:c._id||"",seat_number:c.index??0,is_child:a.age==="Детский",include_children_seat:a.age==="Детский"&&!c,personal_info:{is_adult:a.age==="Взрослый",first_name:a.firstName,last_name:a.lastName,patronymic:a.patronymic,gender:a.sex==="Мужской",birthday:a.birthday??"",document_type:a.document,document_data:a.document==="passport"?`${a.serial}${a.number}`:a.numberBirthCertificate}}}),h={user:m,depature:{route_direction_id:s?.departure._id||"",seats:u(i,p.departurePlace)},arrival:{route_direction_id:s?.arrival?._id||"",seats:u(i,p.arrivalPlace)}},f=async()=>{await S({method:"POST",url:"/order",body:h}).then(n=>n.status)?x("/success"):alert("Ошибка отправки. Повторите попытку позже")},j=_.arrivalPrice.adultPrice+_.departurePrice.adultPrice,g=_.arrivalPrice.childPrice+_.departurePrice.childPrice,y=_.arrivalPrice.servicePrice+_.departurePrice.servicePrice;return e.jsxs("div",{className:t.order,children:[e.jsxs("div",{className:t.order__info,children:[e.jsx(d,{title:"Поезд",children:e.jsx(B,{ticket:s,buttonText:"Изменить"})}),e.jsx(d,{title:"Пассажиры",children:e.jsxs("div",{className:t.passengers,children:[e.jsx("div",{className:t.passengers__info,children:i.map((r,n)=>e.jsx(z,{passenger:r},n))}),e.jsxs("div",{className:t.passengers__total,children:[e.jsxs("p",{className:t.total__text,children:["Всего"," ",e.jsxs("span",{className:t.total__price,children:[(j+g+y).toLocaleString()," ",e.jsx("span",{className:t.total__valute,children:"₽"})]})]}),e.jsx(l,{type:"button",className:"button__transparrent",children:"Изменить"})]})]})}),e.jsx(d,{title:"Способ оплаты",children:e.jsxs("div",{className:t.type__payment,children:[e.jsx("p",{children:m.paymentType==="online"?"Онлайн":"Наличными"}),e.jsx("div",{className:t.payment__button,children:e.jsx(l,{type:"button",className:"button__transparrent",children:"Изменить"})})]})})]}),e.jsx("div",{className:t.order__button,children:e.jsx(l,{onClick:f,type:"button",className:"button__fill_white",children:"Подтвердить"})})]})},d=({title:s,children:_})=>e.jsxs("div",{className:t.info__box,children:[e.jsx("h3",{className:t.info__title,children:s}),_]}),z=({passenger:s})=>e.jsxs("div",{className:t.passenger,children:[e.jsxs("div",{className:t.passenger__age,children:[e.jsx("div",{className:t.circle,children:e.jsx(N,{})}),e.jsx("p",{children:s.age})]}),e.jsxs("div",{className:t.passenger__info,children:[e.jsxs("p",{className:t.passenger__fio,children:[s.lastName," ",s.firstName," ",s.patronymic]}),e.jsxs("span",{children:["Пол ",s.sex]}),e.jsxs("span",{children:["Дата рождения"," ",s.birthday?P(s.birthday).format("DD.MM.YYYY"):"не указана"]}),e.jsx("span",{children:s.document==="passport"?`Паспорт РФ ${s.serial} ${s.number}`:`Свидетельство о рождении ${s.numberBirthCertificate}`})]})]}),K=()=>{const{handleSetValue:s}=C();return T.useEffect(()=>{s(4)},[]),e.jsx(Z,{})};export{K as default};
